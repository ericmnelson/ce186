<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.css">
<!-- Latest compiled and minified JavaScript -->
<script src="http://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.js"></script>

<div class="row wrapper border-bottom white-bg page-heading2">
    <div class="col-lg-10">
        <h2 class="m-l-md">Bathroom Page</h2>
    </div>
</div>
<div class="wrapper wrapper-content animated fadeInRight">
	<div class="row m-b-sm m-t-sm">
	    <!-- <div class="col-md-4 col-md-offset-1"> -->
	    <div class="col-md-3 " style="margin-top:45px;">
	        <div class="profile-image m-l-lg">
	            <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQt5iG0vLTAq0fVdmjAifQ9423T6tddvwz8iQEgh61tGndvqNLQmw" class="img-circle circle-border m-b-md" alt="profile">
	        </div>
	        <div class="profile-info">
	            <div class="">
	                <div>
	                    <h2 class="no-margins" style="padding-top:15px;">
	                        <%= @bathroom.name %>
	                    </h2>
	                    <h4><%= current_house.name %></h4>
	                    <!-- <small>
	                        There are many variations of passages of Lorem Ipsum available, but the majority
	                        have suffered alteration in some form Ipsum available.
	                    </small> -->
	                </div>
	            </div>
	        </div>
	    </div>

	<!-- </div> -->
	<!-- <div class="row"> -->
		<div class="col-md-3">
			<div class="ibox">
				<div class="ibox-title">
					<h5>Real-time Status</h5>
					<div class="ibox-tools">
							<a class="collapse-link">
									<i class="fa fa-chevron-up"></i>
							</a>
							<a class="close-link">
									<i class="fa fa-times"></i>
							</a>
					</div>
				</div>
				<div style="height:160px;" class="ibox-content">
					<span class="text-right m-t-lg">
							<% if @available %>
								<h2 class="text-navy m-b-md">
									<i class="fa fa-circle"></i> Available
								</h2>
								<p> Last Used <%= time_ago_in_words(@last_shower.end_time) %> ago
								<p> by
									<a class="text-navy" href="/users/<%=@last_shower.user.id%>">
										<%=@last_shower.user.full_name%>
									</a>
								</p>
							<% else %>
								<h2 class="text-danger m-b-md">
									<i class="fa fa-ban"></i> Taken
								</h2>
								<h3>
									Current User:
									<a href="/users/<%=@shower_user.id%>">
										<img style="width:50px; height:50px; display:inline;" alt="image" class="img-responsive img-circle" src="<%= @shower_user.avatar.url(:thumb) %>">
									</a>
								</h3>
								<p>
									Shower Started <%= time_ago_in_words(@shower_current.start_time) %> ago
								</p>
							<% end %>
					</span>
				</div>
			</div>
		</div>
		<div class="col-lg-3">
	    <div class="ibox">
					<div class="ibox-title">
						<h5>Usage Statistics</h5>
						<div class="ibox-tools">
							<a class="collapse-link">
								<i class="fa fa-chevron-up"></i>
							</a>
							<a class="close-link">
								<i class="fa fa-times"></i>
							</a>
						</div>
					</div>
	        <div style="height:160px;" class="ibox-content">
	          <table class="table table-stripped m-t-md text-right">
	            <tbody>
	            <tr>
								<td>Total Showered</td>
	              <td><strong><%= @total_duration.round(1) %> hours</strong></td>
	            </tr>
	            <tr>
								<td>Shortest Shower</td>
								<td><strong> <%= @min_length.round(1) %> min. </strong></td>
	            </tr>
	            <tr>
								<td>Longest Shower</td>
								<td><strong> <%= @max_length.round(1) %> min. </strong></td>
	            </tr>
	            </tbody>
	          </table>
		      </div>
		    </div>
		</div>
		<div class="col-lg-3">
	    <div class="ibox">
					<div class="ibox-title">
						<h5>Temperature Statistics</h5>
						<div class="ibox-tools">
							<a class="collapse-link">
								<i class="fa fa-chevron-up"></i>
							</a>
							<a class="close-link">
								<i class="fa fa-times"></i>
							</a>
						</div>
					</div>
	        <div style="height:160px;" class="ibox-content">
	            <table class="table table-stripped m-t-md text-right">
	                <tbody>
	                <tr>
										<td> Avg. Temperature</td>
	                  <td><strong>   <%= @avg_temp.round(1) %> &#8457</strong></td>
	                </tr>
	                <tr>
										<td> Min. Temperature</td>
										<td><strong>   <%= @min_temp.round(1) %> &#8457</strong></td>
	                </tr>
	                <tr>
										<td> Max. Temperature</td>
										<td><strong>   <%= @max_temp.round(1) %> &#8457 </strong></td>
	                </tr>
	                </tbody>
	            </table>
		      </div>
		    </div>
		</div>
	</div>
	<div class="row">
		<div class="col-lg-10 col-lg-offset-1">
			<div class="ibox">
				<div class="ibox-title">
					<h5>Past Showers</h5>
					<div class="ibox-tools">
						<a class="collapse-link">
							<i class="fa fa-chevron-up"></i>
						</a>
						<a class="close-link">
							<i class="fa fa-times"></i>
						</a>
					</div>
				</div>
				<div class="ibox-content">
					<table data-toggle="table" data-pagination="true"
									data-page-size="10" data-page-list="[10,25,50]">
						<thead>
							<tr>
								<th data-field="name" data-sortable="true" data-sorter="nameSorter" data-sort-name="_name_data">User</th>
								<th data-sortable="true" data-sorter="numSorter">Duration</th>
								<th data-sortable="true">Avg Temperature</th>
								<th data-field="timestamp" data-sortable="true" data-sorter="timeSorter" data-sort-name="_timestamp_data">Time</th>
							</tr>
						</thead>
						<tbody>
							<% @bathroom.showers.order(:end_time).reverse.each do |shower| %>
							<tr>
								<td data-name="<%=shower.user.full_name%>">
									<a style="color:#2f4050;" href="/users/<%=shower.user.id%>">
										<img style="width:35px; height:35px; display:inline; margin-right:10px;" alt="image" class="img-responsive img-circle" src="<%= shower.user.avatar.url(:thumb) %>">
										<%= shower.user.full_name %>
									</a>
								</td>
								<td><%= (shower.duration / 60.0).round(1) %> minutes</td>
								<td><%= shower.avg_temp.round(2) %> &#8457</td>
								<td data-timestamp="<%=shower.end_time.to_i %>"><%= time_ago_in_words(shower.end_time) %> ago</td>
							</tr>
							<% end %>
						</tbody>
					</table>

				</div>
			</div>
		</div>
	</div>
</div>
<script>
  function nameSorter(a, b) {
      // a_beg = a.indexOf('">');
      // a_end = a.indexOf('</a>');
      // b_beg = b.indexOf('">');
      // b_end = b.indexOf('</a>');
			// a = a.slice(a_beg, a_end);
			// b = b.slice(b_beg, b_end);
			// a_beg = a.indexOf('">', 3);
			// b_beg = b.indexOf('">', 3);
			// a = a.slice(a_beg);
			// b = b.slice(b_beg);
			a = a.name;
			b = b.name;
      if (a > b) return 1;
      if (a < b) return -1;
      return 0;
  }
	function numSorter(a, b) {
		a = parseFloat(a.slice(0,a.indexOf(" ")));
		b = parseFloat(b.slice(0,b.indexOf(" ")));
		if (a > b) return 1;
		if (a < b) return -1;
		return 0;
	}
	function timeSorter(a, b) {
		a = a.timestamp;
		b = b.timestamp;
		if (a > b) return 1;
		if (a < b) return -1;
		return 0;
	}
</script>
